<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Class Schedule Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .description {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .student-management {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .student-management h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .student-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select,
        input,
        button {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .btn-success {
            background-color: #27ae60;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e8f4fc;
        }
        
        .status-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            padding: 5px 10px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
        
        .summary {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .summary h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .summary-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .summary-item {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
        }
        
        .summary-item h3 {
            color: #7f8c8d;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .summary-item p {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .present {
            color: #27ae60;
        }
        
        .total {
            color: #3498db;
        }
        
        .payment {
            color: #9b59b6;
        }
        
        .payment-settings {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .payment-settings h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .payment-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .yearly-summary {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .yearly-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .yearly-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .yearly-table th {
            background-color: #2c3e50;
        }
        
        .yearly-table tr:hover {
            background-color: #e8f4fc;
        }
        
        .student-info {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .student-info h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .controls,
            .payment-controls,
            .yearly-controls,
            .student-controls {
                flex-direction: column;
            }
            .summary-content {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Student Class Schedule Tracker</h1>
            <p class="description">Track individual student classes, mark attendance, and calculate payments</p>
        </header>

        <div class="student-management">
            <h2>Student Management</h2>
            <div class="student-controls">
                <div class="form-group">
                    <label for="studentSelect">Select Student</label>
                    <select id="studentSelect">
                        <option value="">-- Select Student --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="studentName">Student Name</label>
                    <input type="text" id="studentName" placeholder="Enter student name">
                </div>
                <div class="form-group">
                    <label for="rollNumber">Roll Number</label>
                    <input type="text" id="rollNumber" placeholder="Enter roll number">
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button id="addStudent" class="btn-success">Add New Student</button>
                </div>
            </div>
        </div>

        <div id="currentStudentInfo" class="student-info" style="display: none;">
            <h3 id="selectedStudentName">Student Name</h3>
            <p id="selectedStudentRoll">Roll Number: </p>
        </div>

        <div class="payment-settings">
            <h2>Payment Settings</h2>
            <div class="payment-controls">
                <div class="form-group">
                    <label for="hourlyRate">Hourly Rate (₹)</label>
                    <input type="number" id="hourlyRate" placeholder="Enter hourly rate" value="500">
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button id="updateRate">Update Rate</button>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="form-group">
                <label for="className">Class Name</label>
                <input type="text" id="className" placeholder="Leave empty for auto-generated name">
            </div>
            <div class="form-group">
                <label for="classDate">Date</label>
                <input type="date" id="classDate">
            </div>
            <div class="form-group">
                <label for="startTime">Start Time</label>
                <input type="time" id="startTime" value="09:00">
            </div>
            <div class="form-group">
                <label for="endTime">End Time</label>
                <input type="time" id="endTime" value="10:00">
            </div>
            <div class="form-group">
                <label for="monthSelect">Select Month</label>
                <select id="monthSelect">
                    <option value="0">January</option>
                    <option value="1">February</option>
                    <option value="2">March</option>
                    <option value="3">April</option>
                    <option value="4">May</option>
                    <option value="5">June</option>
                    <option value="6">July</option>
                    <option value="7">August</option>
                    <option value="8">September</option>
                    <option value="9" selected>October</option>
                    <option value="10">November</option>
                    <option value="11">December</option>
                </select>
            </div>
            <div class="form-group">
                <label>&nbsp;</label>
                <button id="addClass">Add Class</button>
            </div>
        </div>

        <div class="table-container">
            <table id="scheduleTable">
                <thead>
                    <tr>
                        <th>Class Name</th>
                        <th>Date</th>
                        <th>Day</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Duration</th>
                        <th>Billable Hours</th>
                        <th>Class Happened</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody">
                    <!-- Table rows will be generated here -->
                </tbody>
            </table>
        </div>

        <div class="summary">
            <h2>Monthly Summary</h2>
            <div class="summary-content">
                <div class="summary-item">
                    <h3>Total Classes</h3>
                    <p id="totalClasses" class="total">0</p>
                </div>
                <div class="summary-item">
                    <h3>Classes Attended</h3>
                    <p id="classesAttended" class="present">0</p>
                </div>
                <div class="summary-item">
                    <h3>Total Duration</h3>
                    <p id="totalDuration">0 hours</p>
                </div>
                <div class="summary-item">
                    <h3>Attendance Rate</h3>
                    <p id="attendanceRate">0%</p>
                </div>
                <div class="summary-item">
                    <h3>Total Billable Hours</h3>
                    <p id="totalBillableHours">0.0</p>
                </div>
                <div class="summary-item">
                    <h3>Total Payment</h3>
                    <p id="totalPayment" class="payment">₹0</p>
                </div>
            </div>
        </div>

        <div class="yearly-summary">
            <h2>Yearly Summary</h2>
            <div class="yearly-controls">
                <div class="form-group">
                    <label for="yearSelect">Select Year</label>
                    <select id="yearSelect">
                        <!-- Years will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button id="generateYearlyReport">Generate Yearly Report</button>
                </div>
            </div>
            <div class="table-container">
                <table class="yearly-table" id="yearlySummaryTable">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Total Classes</th>
                            <th>Classes Attended</th>
                            <th>Attendance Rate</th>
                            <th>Total Billable Hours</th>
                            <th>Total Payment</th>
                        </tr>
                    </thead>
                    <tbody id="yearlySummaryBody">
                        <!-- Yearly summary rows will be generated here -->
                    </tbody>
                    <tfoot>
                        <tr id="yearlyTotalRow" style="display: none;">
                            <td><strong>Year Total</strong></td>
                            <td><strong id="yearTotalClasses">0</strong></td>
                            <td><strong id="yearClassesAttended">0</strong></td>
                            <td><strong id="yearAttendanceRate">0%</strong></td>
                            <td><strong id="yearTotalBillableHours">0.0</strong></td>
                            <td><strong id="yearTotalPayment">₹0</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get current month and set as default
            const currentMonth = new Date().getMonth();
            document.getElementById('monthSelect').value = currentMonth;

            // Set today's date as default
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('classDate').value = formattedDate;

            // Initialize data
            let students = JSON.parse(localStorage.getItem('students')) || [];
            let classes = JSON.parse(localStorage.getItem('classSchedule')) || [];
            let hourlyRate = parseFloat(localStorage.getItem('hourlyRate')) || 500;
            let currentStudentId = null;

            document.getElementById('hourlyRate').value = hourlyRate;

            // DOM elements
            const studentSelect = document.getElementById('studentSelect');
            const studentNameInput = document.getElementById('studentName');
            const rollNumberInput = document.getElementById('rollNumber');
            const addStudentBtn = document.getElementById('addStudent');
            const currentStudentInfo = document.getElementById('currentStudentInfo');
            const selectedStudentName = document.getElementById('selectedStudentName');
            const selectedStudentRoll = document.getElementById('selectedStudentRoll');
            const classNameInput = document.getElementById('className');
            const classDateInput = document.getElementById('classDate');
            const startTimeInput = document.getElementById('startTime');
            const endTimeInput = document.getElementById('endTime');
            const monthSelect = document.getElementById('monthSelect');
            const addClassBtn = document.getElementById('addClass');
            const hourlyRateInput = document.getElementById('hourlyRate');
            const updateRateBtn = document.getElementById('updateRate');
            const scheduleBody = document.getElementById('scheduleBody');
            const totalClassesEl = document.getElementById('totalClasses');
            const classesAttendedEl = document.getElementById('classesAttended');
            const totalDurationEl = document.getElementById('totalDuration');
            const attendanceRateEl = document.getElementById('attendanceRate');
            const totalBillableHoursEl = document.getElementById('totalBillableHours');
            const totalPaymentEl = document.getElementById('totalPayment');
            const yearSelect = document.getElementById('yearSelect');
            const generateYearlyReportBtn = document.getElementById('generateYearlyReport');
            const yearlySummaryBody = document.getElementById('yearlySummaryBody');
            const yearlyTotalRow = document.getElementById('yearlyTotalRow');

            // Initialize dropdowns
            initializeStudentSelect();
            initializeYearSelect();

            // Function to get the next Math class number for a student
            function getNextMathClassNumber(studentId) {
                const studentClasses = classes.filter(cls => cls.studentId === studentId);
                const classNames = studentClasses.map(cls => cls.name);

                let maxNumber = 0;
                classNames.forEach(name => {
                    const match = name.match(/Math Class (\d+)/);
                    if (match && match[1]) {
                        const num = parseInt(match[1]);
                        if (num > maxNumber) {
                            maxNumber = num;
                        }
                    }
                });

                return maxNumber + 1;
            }

            // Initialize student select dropdown
            function initializeStudentSelect() {
                studentSelect.innerHTML = '<option value="">-- Select Student --</option>';

                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.rollNumber})`;
                    studentSelect.appendChild(option);
                });
            }

            // Initialize year select dropdown
            function initializeYearSelect() {
                const currentYear = new Date().getFullYear();
                yearSelect.innerHTML = '';

                for (let i = currentYear; i >= currentYear - 5; i--) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    if (i === currentYear) {
                        option.selected = true;
                    }
                    yearSelect.appendChild(option);
                }
            }

            // Add new student
            addStudentBtn.addEventListener('click', function() {
                const name = studentNameInput.value.trim();
                const rollNumber = rollNumberInput.value.trim();

                if (!name || !rollNumber) {
                    alert('Please enter both student name and roll number');
                    return;
                }

                // Check if roll number already exists
                if (students.some(student => student.rollNumber === rollNumber)) {
                    alert('Roll number already exists. Please use a unique roll number.');
                    return;
                }

                const newStudent = {
                    id: Date.now(),
                    name: name,
                    rollNumber: rollNumber
                };

                students.push(newStudent);
                localStorage.setItem('students', JSON.stringify(students));

                // Clear inputs
                studentNameInput.value = '';
                rollNumberInput.value = '';

                // Update dropdown
                initializeStudentSelect();

                // Select the new student
                studentSelect.value = newStudent.id;
                studentSelect.dispatchEvent(new Event('change'));

                alert('Student added successfully!');
            });

            // Student selection change
            studentSelect.addEventListener('change', function() {
                currentStudentId = this.value;

                if (currentStudentId) {
                    const student = students.find(s => s.id == currentStudentId);
                    if (student) {
                        selectedStudentName.textContent = student.name;
                        selectedStudentRoll.textContent = `Roll Number: ${student.rollNumber}`;
                        currentStudentInfo.style.display = 'block';
                    }
                } else {
                    currentStudentInfo.style.display = 'none';
                }

                renderTable();
                updateSummary();
            });

            // Update hourly rate
            updateRateBtn.addEventListener('click', function() {
                const newRate = parseFloat(hourlyRateInput.value);
                if (isNaN(newRate) || newRate <= 0) {
                    alert('Please enter a valid hourly rate');
                    return;
                }
                hourlyRate = newRate;
                localStorage.setItem('hourlyRate', hourlyRate);
                updateSummary();
            });

            // Add class event
            addClassBtn.addEventListener('click', function() {
                if (!currentStudentId) {
                    alert('Please select a student first');
                    return;
                }

                let className = classNameInput.value.trim();
                const classDate = classDateInput.value;
                const startTime = startTimeInput.value;
                const endTime = endTimeInput.value;

                // If class name is empty, generate one automatically
                if (!className) {
                    const nextNumber = getNextMathClassNumber(currentStudentId);
                    className = `Math Class ${nextNumber}`;
                }

                if (!classDate) {
                    alert('Please select a date');
                    return;
                }

                if (!startTime || !endTime) {
                    alert('Please select both start and end times');
                    return;
                }

                // Calculate duration and billable hours
                const duration = calculateDuration(startTime, endTime);
                const billableHours = calculateBillableHours(duration);

                // Format date as 1-January-2025 and get day name
                const formattedDate = formatDate(classDate);
                const dayName = getDayName(classDate);
                const classMonth = new Date(classDate).getMonth();
                const classYear = new Date(classDate).getFullYear();

                // Add to classes array
                classes.push({
                    id: Date.now(),
                    studentId: currentStudentId,
                    name: className,
                    date: classDate,
                    formattedDate: formattedDate,
                    days: dayName,
                    startTime: startTime,
                    endTime: endTime,
                    duration: duration,
                    billableHours: billableHours,
                    happened: false,
                    month: classMonth,
                    year: classYear
                });

                // Save to localStorage
                localStorage.setItem('classSchedule', JSON.stringify(classes));

                // Clear inputs
                classNameInput.value = '';

                // Refresh table and summary
                renderTable();
                updateSummary();
            });

            // Month change event
            monthSelect.addEventListener('change', function() {
                renderTable();
                updateSummary();
            });

            // Generate yearly report
            generateYearlyReportBtn.addEventListener('click', function() {
                generateYearlySummary();
            });

            // Format date as 1-January-2025
            function formatDate(dateString) {
                const date = new Date(dateString);
                const day = date.getDate();
                const month = date.toLocaleString('default', {
                    month: 'long'
                });
                const year = date.getFullYear();
                return `${day}-${month}-${year}`;
            }

            // Get day name from date
            function getDayName(dateString) {
                const date = new Date(dateString);
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                return days[date.getDay()];
            }

            // Calculate duration between two times
            function calculateDuration(start, end) {
                const startParts = start.split(':');
                const endParts = end.split(':');

                const startHour = parseInt(startParts[0]);
                const startMinute = parseInt(startParts[1]);
                const endHour = parseInt(endParts[0]);
                const endMinute = parseInt(endParts[1]);

                let durationHours = endHour - startHour;
                let durationMinutes = endMinute - startMinute;

                if (durationMinutes < 0) {
                    durationHours--;
                    durationMinutes += 60;
                }

                // Handle cases where end time is before start time (overnight)
                if (durationHours < 0) {
                    durationHours += 24;
                }

                return {
                    hours: durationHours,
                    minutes: durationMinutes,
                    totalMinutes: durationHours * 60 + durationMinutes
                };
            }

            // Calculate billable hours based on duration
            function calculateBillableHours(duration) {
                const totalMinutes = duration.totalMinutes;

                // If 75 minutes or less = 1 hour
                if (totalMinutes <= 75) {
                    return 1.0;
                }

                // Calculate base hours (each 60 minutes = 1 hour)
                const baseHours = Math.floor(totalMinutes / 60);

                // Calculate extra minutes beyond base hours
                const extraMinutes = totalMinutes % 60;

                // Calculate billable hours based on extra minutes
                if (extraMinutes <= 15) {
                    // 0-15 extra minutes = no additional charge
                    return baseHours;
                } else if (extraMinutes <= 45) {
                    // 16-45 extra minutes = +0.5 hour
                    return baseHours + 0.5;
                } else {
                    // 46+ extra minutes = +1 hour (rounds up to next full hour)
                    return baseHours + 1;
                }
            }

            // Format duration for display
            function formatDuration(duration) {
                if (duration.hours === 0) {
                    return `${duration.minutes} min`;
                } else if (duration.minutes === 0) {
                    return `${duration.hours} hr`;
                } else {
                    return `${duration.hours} hr ${duration.minutes} min`;
                }
            }

            // Render the table
            function renderTable() {
                if (!currentStudentId) {
                    scheduleBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Please select a student to view classes</td></tr>';
                    return;
                }

                const selectedMonth = parseInt(monthSelect.value);
                const filteredClasses = classes.filter(cls =>
                    cls.studentId === currentStudentId && cls.month === selectedMonth
                );

                scheduleBody.innerHTML = '';

                if (filteredClasses.length === 0) {
                    scheduleBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No classes scheduled for this month</td></tr>';
                    return;
                }

                filteredClasses.forEach(cls => {
                    const row = document.createElement('tr');

                    // Ensure billableHours is a number
                    const billableHours = typeof cls.billableHours === 'number' ? cls.billableHours : 0;

                    row.innerHTML = `
                        <td>${cls.name}</td>
                        <td>${cls.formattedDate}</td>
                        <td>${cls.days}</td>
                        <td>${formatTimeDisplay(cls.startTime)}</td>
                        <td>${formatTimeDisplay(cls.endTime)}</td>
                        <td>${formatDuration(cls.duration)}</td>
                        <td>${billableHours.toFixed(1)} hrs</td>
                        <td>
                            <input type="checkbox" class="status-checkbox" ${cls.happened ? 'checked' : ''} 
                                   data-id="${cls.id}">
                        </td>
                        <td>
                            <button class="delete-btn" data-id="${cls.id}">Delete</button>
                        </td>
                    `;

                    scheduleBody.appendChild(row);
                });

                // Add event listeners for checkboxes
                document.querySelectorAll('.status-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        const classIndex = classes.findIndex(cls => cls.id === id);

                        if (classIndex !== -1) {
                            classes[classIndex].happened = this.checked;
                            localStorage.setItem('classSchedule', JSON.stringify(classes));
                            updateSummary();
                        }
                    });
                });

                // Add event listeners for delete buttons
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        classes = classes.filter(cls => cls.id !== id);
                        localStorage.setItem('classSchedule', JSON.stringify(classes));
                        renderTable();
                        updateSummary();
                    });
                });
            }

            // Format time for display (convert to AM/PM)
            function formatTimeDisplay(time) {
                const [hours, minutes] = time.split(':');
                const hour = parseInt(hours);
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;

                return `${displayHour}:${minutes} ${ampm}`;
            }

            // Update summary information
            function updateSummary() {
                if (!currentStudentId) {
                    // Reset summary if no student selected
                    totalClassesEl.textContent = '0';
                    classesAttendedEl.textContent = '0';
                    totalDurationEl.textContent = '0 hours';
                    attendanceRateEl.textContent = '0%';
                    totalBillableHoursEl.textContent = '0.0';
                    totalPaymentEl.textContent = '₹0';
                    return;
                }

                const selectedMonth = parseInt(monthSelect.value);
                const filteredClasses = classes.filter(cls =>
                    cls.studentId === currentStudentId && cls.month === selectedMonth
                );

                const totalClasses = filteredClasses.length;
                const classesAttended = filteredClasses.filter(cls => cls.happened).length;

                // Calculate total duration and billable hours
                let totalHours = 0;
                let totalMinutes = 0;
                let totalBillableHours = 0;

                filteredClasses.forEach(cls => {
                    if (cls.happened) {
                        totalHours += cls.duration.hours;
                        totalMinutes += cls.duration.minutes;

                        // Ensure billableHours is a number
                        const billableHours = typeof cls.billableHours === 'number' ? cls.billableHours : 0;
                        totalBillableHours += billableHours;
                    }
                });

                // Convert minutes to hours if needed
                totalHours += Math.floor(totalMinutes / 60);
                totalMinutes = totalMinutes % 60;

                // Calculate attendance rate
                const attendanceRate = totalClasses > 0 ? Math.round((classesAttended / totalClasses) * 100) : 0;

                // Calculate total payment
                const totalPayment = totalBillableHours * hourlyRate;

                // Update DOM elements
                totalClassesEl.textContent = totalClasses;
                classesAttendedEl.textContent = classesAttended;

                if (totalHours === 0 && totalMinutes === 0) {
                    totalDurationEl.textContent = '0 hours';
                } else if (totalMinutes === 0) {
                    totalDurationEl.textContent = `${totalHours} hours`;
                } else {
                    totalDurationEl.textContent = `${totalHours} hours ${totalMinutes} minutes`;
                }

                attendanceRateEl.textContent = `${attendanceRate}%`;
                totalBillableHoursEl.textContent = totalBillableHours.toFixed(1);
                totalPaymentEl.textContent = `₹${totalPayment.toFixed(0)}`;
            }

            // Generate yearly summary
            function generateYearlySummary() {
                if (!currentStudentId) {
                    alert('Please select a student first');
                    return;
                }

                const selectedYear = parseInt(yearSelect.value);
                yearlySummaryBody.innerHTML = '';

                const monthNames = [
                    'January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'
                ];

                let yearTotalClasses = 0;
                let yearClassesAttended = 0;
                let yearTotalBillableHours = 0;
                let yearTotalPayment = 0;

                for (let month = 0; month < 12; month++) {
                    const monthlyClasses = classes.filter(cls =>
                        cls.studentId === currentStudentId &&
                        cls.month === month &&
                        cls.year === selectedYear
                    );

                    const monthlyTotalClasses = monthlyClasses.length;
                    const monthlyClassesAttended = monthlyClasses.filter(cls => cls.happened).length;

                    let monthlyBillableHours = 0;
                    monthlyClasses.forEach(cls => {
                        if (cls.happened) {
                            monthlyBillableHours += cls.billableHours;
                        }
                    });

                    const monthlyPayment = monthlyBillableHours * hourlyRate;
                    const monthlyAttendanceRate = monthlyTotalClasses > 0 ?
                        Math.round((monthlyClassesAttended / monthlyTotalClasses) * 100) : 0;

                    // Add to yearly totals
                    yearTotalClasses += monthlyTotalClasses;
                    yearClassesAttended += monthlyClassesAttended;
                    yearTotalBillableHours += monthlyBillableHours;
                    yearTotalPayment += monthlyPayment;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${monthNames[month]}</td>
                        <td>${monthlyTotalClasses}</td>
                        <td>${monthlyClassesAttended}</td>
                        <td>${monthlyAttendanceRate}%</td>
                        <td>${monthlyBillableHours.toFixed(1)}</td>
                        <td>₹${monthlyPayment.toFixed(0)}</td>
                    `;
                    yearlySummaryBody.appendChild(row);
                }

                // Update yearly totals
                const yearAttendanceRate = yearTotalClasses > 0 ?
                    Math.round((yearClassesAttended / yearTotalClasses) * 100) : 0;

                document.getElementById('yearTotalClasses').textContent = yearTotalClasses;
                document.getElementById('yearClassesAttended').textContent = yearClassesAttended;
                document.getElementById('yearAttendanceRate').textContent = `${yearAttendanceRate}%`;
                document.getElementById('yearTotalBillableHours').textContent = yearTotalBillableHours.toFixed(1);
                document.getElementById('yearTotalPayment').textContent = `₹${yearTotalPayment.toFixed(0)}`;

                // Show yearly total row
                yearlyTotalRow.style.display = 'table-row';
            }

            // Initial render
            renderTable();
            updateSummary();
        });
    </script>
</body>

</html>